JWT와 Session은 모두 사용자의 인증 상태를 유지하고 관리하기 위한 방법이다.
주요 차이점은 사용자 정보를 어디에 저장하고, 어떻게 검증하는지에 있다.
세션은 서버에 사용자 정보를 저장하고, JWT는 사용자 정보를 토큰 자체에 담아서 클라이언트에 저장한다.

## Session

- Session은 특수한 ID 값으로 구성되어있다.
- Session은 서버에서 생성되며 클라이언트에서 쿠키를 통해 저장된다.
- 클라이언트에서 요청을 보낼 때, Session ID를 같이 보내면 현재 요청을 보내는 사용자가 누구인지 서버에서 알 수 있다.
  - 요청마다 매번 아이디와 비밀번호를 물어볼 필요가 없다.
- Session ID는 데이터베이스에 저장되기때문에 요청이 있을 때마다 매번 데이터베이스를 확인해야 한다.
- 서버에서 데이터가 저장되기때문에 클라이언트에 사용자 정보가 노출될 위험이 없다.
  - Session ID는 아무런 의미가 없는 정보이다.
- 데이터베이스에 Session을 저장해야하기때문에 Horizontal Scaling이 어렵다.
  - Redis가 될 수도 있고, In-Memory로 저장할 수도 있다.
  - 어떻게든 Session 정보를 저장해야 수평 확장시 서버들이 같은 정보를 바라보고 사용자 정보를 판단할 수 있다.
  - 수평 확장시 세션 정보를 저장하고 다를 수 있는 스토리도 같이 스케일링 해야 한다.
  - 리소스 적인 단점이 될 수도 있다.

## JWT

- 유저의 정보를 Base 64로 인코딩된 String 값에 저장하는 도구이다.
- JWT Token은 header, payload, signature로 구성되어 있고 Base64로 인코딩 되어 있다.
  - signature 값이 헤더와 페이로드, JWT가 그 안에 변형이 되지 않았다는 검증을 해주는 부분이다.
- JWT는 서버에서 생성되며 클라이언트에서 저장된다.
- 클라이언트에서 요청을 보낼 때, JWT Token ID를 같이 보내면 현재 요청을 보내는 사용자가 누구인지 서버에서 알 수 있다. (요청마다 매번 아이디와 비밀번호를 물어볼 필요가 없다.)
- JWT는 데이터베이스에 저장되지 않고 Signature 값을 이용해서 검증할 수 있다.
  - 검증할 때마다 데이터베이스를 매번 확인할 필요 없다.
- 정보가 모두 토큰에 담겨있고 클라이언트에서 토큰을 저장하기 때문에 정보 유출의 위험이 있다.
  - payload 부분에 사용자를 특정할 수 있는 정보를 담고 있다.
- 데이터베이스가 필요없으므로 수평 확장이 쉽다.

- 토큰은 탈취하면 열어볼 수 있다. 이 정보 유출이 보안 문제냐 아니냐는
- 토큰을 어떻게 저장하냐에 따라 다르고
- 그 안에 어떤 정보를 저장하냐에 따라 다른다.
- 단순히 아이디만 넣고, 아이디를 아는 게 큰 이득이 되는 상태로 서버를 구성하면 유출되어도 상관 없다.
- 해당 토큰을 가지고 해당 사용자인 것처럼 작업을 수행할 수도 있지만 이는 refresh token, access token에 대해 설명할 때 조금 더 알아본다.

## Session 생성 방식

Client ↔ API Server ↔ Databse

1. Client에서 API 서버로 ID/Password를 전송한다.
2. API 서버에서 ID, password를 검증한다.
3. API 서버에서 세션을 생성하고 데이터베이스로 저장한다.
4. API 서버에서 쿠키를 클라이언트로 전송한다.

## Session 사용 방식

1. Client에서 API 서버로 쿠키를 전송한다.
2. API 서버에서 쿠키를 검증한다.
3. API 서버에서 데이터베이스로 Session을 검색한다.
4. Database에서 API 서버로 Session에 해당하는 유저 정보를 응답한다.
5. API 서버에서 Database로 데이터를 요청한다.
6. 데이터베이스에서 API Server로 데이터를 응답한다.
7. API 서버에서 클라이언트로 데이터를 전송한다.

## JWT Token 생성 방식

Client ↔ API Server

1. client 에서 API Server 로 id/password를 전송한다.
2. api server에서 id/password를 검증한다.
3. api server에서 client로 token을 전송한다.

## JWT Token 사용 방식

1. Client에서 API server로 token을 전송한다.
2. API server에서 token을 검증한다.
3. API server에서 DB에 데이터를 요청한다.
4. DB에서 API 서버로 결과를 응답한다.
5. API sever에서 Client로 데이터를 전송한다.

## Session vs JWT Token 비교

|                                                       |  Session  |                       JWT Token                       |
| :---------------------------------------------------- | :-------: | :---------------------------------------------------: |
| 유저의 정보를 어디에서 저장하는가?                    |   서버    |                      클라이언트                       |
| 클라이언트에서 서버로 보내는 정보는?                  |   쿠키    |                         토큰                          |
| 유저 정보를 가져올 때 데이터베이스를 확인해야 하는가? | 확인 필요 | 토큰의 playload에 있는 정보만 필요할 경우에 확인한다. |
| 클라이언트에서 인증 정보를 읽을 수 있는가?            |  불가능   |                         가능                          |
| Horizontal Scaling이 쉬운가?                          |  어려움   |                         쉬움                          |
