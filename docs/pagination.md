## Pagination

많은 데이터를 부분적으로 나눠서 불러오는 기술

### 특징

- 쿼리에 해당되는 모든 데이터를 한번에 다 불러오지 않고 부분적으로 쪼개서 불러온다. - 예) 한 번에 20개씩
- 쿠팡같은 앱의 경우 수억 개의 상품이 데이터베이스에 저장되어 있는데, 사용자가 상품 검색 화면에 들어갈 때마다 모든 상품정보를 서버에서 클라이언트로 전송할 필요가 없다.
- 현대 클라우드 시스템은 데이터 전송에 돈이 든다.
- 돈이 안들더라도 수억 개의 데이터를 한 번에 보내면 분명 메모리가 터질 것이다.
- 메모리가 터지지 않더라도 데이터 전송에 상당히 오랜 시간이 걸릴 것이다.

### Page Based Pagination

- 페이지 기준으로 데이터를 잘라서 요청하는 Pagination
- 요청을 보낼 때 원하는 데이터 갯수와 몇 번째 페이지를 가져올지 명시
- 페이지 숫자를 누르면 다음 페이지로 넘어가는 형태의 UI에서 많이 사용
- Pagination 도중에 데이터베이스에서 데이터가 추가되거나 삭제될 경우 저장되는 데이터가 누락되거나 중복될 수 있음
- Pagination 알고리즘이 매우 간단함 (서버 입장)

#### 문제점 (데이터 삽입)

take 4
1 2 3 3.5 4 5 6 7
중간에 3.5가 넣어졌을 때 4번이 1page와 2page에서 중복이 된다.

이미 가져온 데이터 중간에 새로운 데이터가 생겼을 때 이미 가져온 것을 중복으로 생길 수 있다.

- 데이터 삭제
  1 2 3 4 / 5 6 7 8 / 9 10 11 12
  중간에 4번이 삭제되면 1 2 3 를 가져오고 다음에 6 7 8 9를 가져온다.
  -> 데이터가 누락되는 문제

### Cursor Based Pagination

- 가장 최근에 가져온 데이터를 기준으로 다음 데이터를 가져오는 Pagination
- 요청을 보낼 때 마지막 데이터 기준값(ID 등 Unique값)과 몇 개의 데이터를 가져올지 명시
- 스크롤 형태의 리스트에서 자주 사용한다.
  - 예) 앱의 ListView
- 최근 데이터의 기준 값을 기반으로 쿼리가 작성되기 때문에 데이터가 누락되거나 중복될 확률이 적다.

1번 요청은 처음 4개를 가져와라
2번 요청은 id가 4 초과인 것의 다음 데이터 4개를 가져와라.

#### 데이터 추가 되었을 때

1 2 3 3.5 4

1 2 3 (3.5) 4를 가져옴 > 4초과의 4개 이라서 5 6 7 8이 나옴
3.5가 누락되는데 신규데이터라 어쩔 수 없다. 신규 데이터를 이용해야 한다.

1 2 3 (4삭제됨) 5 6 7 8
처음 4개를 가져오면 id가 4보다 큰 데이터 4개를 가져와라 이므로 다음 데이터는 5번이다.
따라서 5번 데이터가 누락되지 않는다.

### 요청 형태

http://localhost:3000/posts?order_createdAt=ASC&where_id_more_than=3&take=20

{property}\_{fiter} 형식으로 구현한다.

order_createdAt: 내림/오름차 정렬
where_id_more_than: 어떤 ID 이후로부터 데이터를 요청할 건지
take: 몇 개의 데이터를 요청할 건지

### 응답의 구조

```json
{
    "data": [
        {
            ...
        },
        ...
    ],
    // paging 관련 정보 입력
    "paging: {
        // 다음 커서에 대한 정보
        "cursor": {
            "after": 4
        },
        // 총 몇 개의 데이터가 응답왔는지
        "count": 20,
        // 다음 요청 URL
        "next": "http://localhost:3000/posts?order__createdAt=ASC&take=20&where__id__more_than=4"
    }
}
```
